<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¶åº­ä¸ªç¨ä¼˜åŒ–è®¡ç®—å™¨ (å…¨åŠŸèƒ½ç»ˆæç‰ˆ)</title>
    <style>
        :root { --primary: #3f51b5; --accent: #ff9800; --bg: #f4f7f6; --text: #2c3e50; --border: #e0e0e0; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); padding: 20px; line-height: 1.5; }
        .container { max-width: 1000px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        h1 { text-align: center; margin-bottom: 25px; font-weight: 700; color: #1a237e; }
        
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        @media(max-width:768px){ .grid-2 { grid-template-columns: 1fr; } }

        /* å¡ç‰‡æ ·å¼ */
        .card { border: 1px solid var(--border); border-radius: 8px; padding: 20px; background: #fff; }
        .card-header { font-weight: bold; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        
        /* æ ‡ç­¾ */
        .tag { padding: 3px 8px; border-radius: 4px; color: #fff; font-size: 12px; font-weight: bold; }
        .tag-a { background: #3f51b5; }
        .tag-b { background: #e91e63; }

        /* è¡¨å•æ§ä»¶ */
        .form-group { margin-bottom: 12px; }
        .form-group label { display: block; font-size: 13px; color: #666; margin-bottom: 4px; font-weight: 500; }
        input[type="number"], select { width: 100%; padding: 9px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 14px; }
        input:focus, select:focus { border-color: var(--primary); outline: none; }

        /* è‡ªåŠ¨è®¡ç®—ç›’å­ */
        .auto-box { background: #f8fbff; border: 1px dashed #bbdefb; padding: 12px; border-radius: 6px; margin-bottom: 12px; display: none; }
        .auto-box.show { display: block; }
        .toggle-label { font-size: 13px; color: var(--primary); cursor: pointer; display: flex; align-items: center; }
        .toggle-label input { margin-right: 6px; }

        /* ç­–ç•¥åŒºåŸŸ */
        .strategy-section { background: #fff8e1; border: 1px solid #ffe0b2; padding: 20px; border-radius: 8px; margin-top: 20px; }
        .warn-text { color: #c62828; font-size: 12px; background: #ffebee; padding: 8px; border-radius: 4px; margin-top: 5px; display: none; }
        
        /* ç»“æœåŒºåŸŸ */
        .result-bar { background: #263238; color: #fff; padding: 20px; border-radius: 8px; margin-top: 25px; display: flex; justify-content: space-between; align-items: center; }
        .save-val { color: var(--accent); font-size: 26px; font-weight: bold; }

        /* è¡¨æ ¼ */
        .table-wrap { overflow-x: auto; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th { background: #eceff1; padding: 12px; text-align: left; font-weight: 600; color: #555; white-space: nowrap; }
        td { padding: 10px 12px; border-bottom: 1px solid #eee; }
        tr.best-row { background: #e0f2f1; font-weight: 700; border-left: 4px solid var(--success); }
        tr.clickable { cursor: pointer; transition: background 0.2s; }
        tr.clickable:hover { background: #f5f5f5; }
        
        /* è¯¦æƒ…å±•å¼€ */
        tr.detail-row { display: none; background: #fafafa; }
        tr.detail-row.open { display: table-row; }
        .detail-pane { padding: 15px; border-left: 4px solid #ddd; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .detail-col h4 { margin: 0 0 10px 0; font-size: 14px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .calc-line { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 4px; color: #555; }
        .calc-line.total { font-weight: bold; color: #000; border-top: 1px dashed #ccc; padding-top: 4px; margin-top: 4px; }

    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ å®¶åº­ä¸ªç¨ä¼˜åŒ–è®¡ç®—å™¨ <span style="font-size:14px;font-weight:normal;color:#888;">(ç»ˆæç‰ˆ)</span></h1>

    <div class="grid-2">
        <div class="card">
            <div class="card-header">
                <span><span class="tag tag-a">A</span> æ”¶å…¥æƒ…å†µ (å¦‚ä¸ˆå¤«)</span>
            </div>
            <div class="form-group">
                <label>å¹´åº¦ç¨å‰æ€»æ”¶å…¥ (å…ƒ)</label>
                <input type="number" id="incA" value="300000" oninput="calc()">
            </div>
            
            <div class="form-group">
                <label class="toggle-label">
                    <input type="checkbox" id="autoA" onchange="toggleAuto('A')" checked> 
                    è‡ªåŠ¨è®¡ç®—äº”é™©ä¸€é‡‘
                </label>
                <div id="boxAutoA" class="auto-box show">
                    <div class="form-group">
                        <label>æœˆç¤¾ä¿åŸºæ•°</label>
                        <input type="number" id="baseA" value="20000" oninput="calc()">
                    </div>
                    <div class="form-group">
                        <label>ä¸ªäººç¼´çº³æ¯”ä¾‹åˆè®¡ (%)</label>
                        <input type="number" id="rateA" value="20.5" placeholder="é»˜è®¤çº¦20.5%">
                    </div>
                    <div style="font-size:12px; color:#666;">ğŸ‘‰ å¹´æ‰£é™¤: <span id="resSocA" style="font-weight:bold">0</span></div>
                </div>
                <div id="boxManualA" style="display:none;">
                    <label>äº”é™©ä¸€é‡‘å¹´ç¼´çº³æ€»é¢</label>
                    <input type="number" id="manualSocA" value="0" oninput="calc()">
                </div>
            </div>

            <div class="form-group">
                <label>å…¶ä»–å›ºå®šæ‰£é™¤ (å¹´æ€»é¢)</label>
                <input type="number" id="fixA" value="0" placeholder="èµ¡å…»è€äºº/å¤§ç—…åŒ»ç–—ç­‰" oninput="calc()">
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <span><span class="tag tag-b">B</span> æ”¶å…¥æƒ…å†µ (å¦‚å¦»å­)</span>
            </div>
            <div class="form-group">
                <label>å¹´åº¦ç¨å‰æ€»æ”¶å…¥ (å…ƒ)</label>
                <input type="number" id="incB" value="150000" oninput="calc()">
            </div>

            <div class="form-group">
                <label class="toggle-label">
                    <input type="checkbox" id="autoB" onchange="toggleAuto('B')" checked> 
                    è‡ªåŠ¨è®¡ç®—äº”é™©ä¸€é‡‘
                </label>
                <div id="boxAutoB" class="auto-box show">
                    <div class="form-group">
                        <label>æœˆç¤¾ä¿åŸºæ•°</label>
                        <input type="number" id="baseB" value="10000" oninput="calc()">
                    </div>
                    <div class="form-group">
                        <label>ä¸ªäººç¼´çº³æ¯”ä¾‹åˆè®¡ (%)</label>
                        <input type="number" id="rateB" value="20.5">
                    </div>
                    <div style="font-size:12px; color:#666;">ğŸ‘‰ å¹´æ‰£é™¤: <span id="resSocB" style="font-weight:bold">0</span></div>
                </div>
                <div id="boxManualB" style="display:none;">
                    <label>äº”é™©ä¸€é‡‘å¹´ç¼´çº³æ€»é¢</label>
                    <input type="number" id="manualSocB" value="0" oninput="calc()">
                </div>
            </div>

            <div class="form-group">
                <label>å…¶ä»–å›ºå®šæ‰£é™¤ (å¹´æ€»é¢)</label>
                <input type="number" id="fixB" value="0" oninput="calc()">
            </div>
        </div>
    </div>

    <div class="strategy-section">
        <h3 style="margin:0 0 15px 0; color:#e65100; font-size:16px;">âš–ï¸ ä¸“é¡¹é™„åŠ æ‰£é™¤æ™ºèƒ½åˆ†é…</h3>
        
        <div class="grid-2">
            <div>
                <div class="form-group">
                    <label>ğŸ‘¶ 3å²ä»¥ä¸‹å©´å¹¼å„¿ (ä¸ª) [2000å…ƒ/æœˆ]</label>
                    <input type="number" id="numInfant" value="1" min="0" oninput="calc()">
                </div>
                <div class="form-group">
                    <label>ğŸ“ å­å¥³æ•™è‚² (ä¸ª) [2000å…ƒ/æœˆ]</label>
                    <input type="number" id="numChild" value="0" min="0" oninput="calc()">
                </div>
            </div>

            <div style="background:#fff; padding:15px; border-radius:6px; border:1px solid #eee;">
                <div class="form-group">
                    <label style="color:#d81b60;">ğŸ˜ï¸ ä½æˆ¿æ‰£é™¤ç±»å‹ (äºŒé€‰ä¸€)</label>
                    <select id="houseType" onchange="toggleHouse()">
                        <option value="none">æ— </option>
                        <option value="loan" selected>ä½æˆ¿è´·æ¬¾åˆ©æ¯ (1000/æœˆ)</option>
                        <option value="rent">ä½æˆ¿ç§Ÿé‡‘ (æŒ‰åŸå¸‚æ ‡å‡†)</option>
                    </select>
                </div>

                <div id="panelLoan">
                    <div style="font-size:12px; color:#666;">è§„åˆ™ï¼šé¦–å¥—æˆ¿è´·åˆ©æ¯ï¼Œå®šé¢æ‰£é™¤12000å…ƒ/å¹´ã€‚</div>
                </div>

                <div id="panelRent" style="display:none;">
                    <div class="form-group">
                        <label>ç§Ÿé‡‘æ‰£é™¤æ ‡å‡† (å…ƒ/æœˆ)</label>
                        <input type="number" id="rentStd" value="1500" oninput="calc()">
                        <div style="font-size:12px; color:#999;">(ç›´è¾–å¸‚/çœä¼š1500, å¤§äº100ä¸‡äººå£1100, å…¶ä»–800)</div>
                    </div>
                    <div class="form-group">
                        <label>å¤«å¦»å·¥ä½œåŸå¸‚</label>
                        <select id="rentMode" onchange="calc()">
                            <option value="same">åŒåŸ (ä»…ä¸€æ–¹å¯æ‰£ï¼Œä¸å¯å¹³åˆ†)</option>
                            <option value="diff">å¼‚åœ° (ä¸¤åœ°å‡æ— æˆ¿ï¼Œå¯åˆ†åˆ«æ‰£)</option>
                        </select>
                    </div>
                    <div id="rentWarn" class="warn-text">âš ï¸ æç¤ºï¼šåŒåŸç§Ÿæˆ¿ä¸èƒ½å¹³åˆ†ï¼Œåªèƒ½ç”±æ‰¿ç§Ÿäºº(ä¸€æ–¹)æ‰£é™¤ã€‚</div>
                </div>
            </div>
        </div>
    </div>

    <div class="result-bar">
        <div>
            <div style="font-size:14px; opacity:0.8">æœ€ä¼˜æ–¹æ¡ˆå®¶åº­æ€»ç¨é¢</div>
            <div style="font-size:24px; font-weight:bold"><span id="txtTotal">0</span> å…ƒ</div>
        </div>
        <div style="text-align:right">
            <div style="font-size:14px; opacity:0.8">ç›¸æ¯”æœ€å·®æ–¹æ¡ˆèŠ‚çœ</div>
            <div class="save-val"><span id="txtSave">0</span> å…ƒ</div>
        </div>
    </div>

    <div class="table-wrap">
        <h4 style="margin:20px 0 10px 0; color:#555;">ğŸ“Š æ–¹æ¡ˆå¯¹æ¯” (ç‚¹å‡»è¡ŒæŸ¥çœ‹è®¡ç®—è¿‡ç¨‹)</h4>
        <table id="tblResult">
            <thead>
                <tr>
                    <th width="50">æ’å</th>
                    <th>ğŸ‘¶ è‚²å„¿åˆ†é…</th>
                    <th>ğŸ“ æ•™è‚²åˆ†é…</th>
                    <th>ğŸ˜ï¸ ä½æˆ¿åˆ†é…</th>
                    <th align="right">A ç¨é¢</th>
                    <th align="right">B ç¨é¢</th>
                    <th align="right">å®¶åº­æ€»ç¨</th>
                    <th width="30"></th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

</div>

<script>
    // ä¸ªç¨ç¨ç‡è¡¨ (2024ç»¼åˆæ‰€å¾—)
    const BRACKETS = [
        { limit: 36000, rate: 0.03, ded: 0 },
        { limit: 144000, rate: 0.10, ded: 2520 },
        { limit: 300000, rate: 0.20, ded: 16920 },
        { limit: 420000, rate: 0.25, ded: 31920 },
        { limit: 660000, rate: 0.30, ded: 52920 },
        { limit: 960000, rate: 0.35, ded: 85920 },
        { limit: Infinity, rate: 0.45, ded: 181920 }
    ];

    // å·¥å…·å‡½æ•°
    const $ = id => document.getElementById(id);
    const getVal = id => parseFloat($(id).value) || 0;

    // åˆ‡æ¢ç¤¾ä¿è®¡ç®—æ¨¡å¼
    function toggleAuto(role) {
        const isAuto = $('auto' + role).checked;
        $('boxAuto' + role).style.display = isAuto ? 'block' : 'none';
        $('boxManual' + role).style.display = isAuto ? 'none' : 'block';
        calc();
    }

    // åˆ‡æ¢ä½æˆ¿ç±»å‹
    function toggleHouse() {
        const type = $('houseType').value;
        $('panelLoan').style.display = type === 'loan' ? 'block' : 'none';
        $('panelRent').style.display = type === 'rent' ? 'block' : 'none';
        
        // ç§Ÿé‡‘åŒåŸè­¦å‘Š
        const rentMode = $('rentMode').value;
        if(type === 'rent' && rentMode === 'same') $('rentWarn').style.display = 'block';
        else $('rentWarn').style.display = 'none';
        
        calc();
    }

    // æ ¸å¿ƒç®—ç¨ (è¿”å›è¯¦ç»†å¯¹è±¡)
    function computeTaxDetail(income, social, ded) {
        let taxable = income - 60000 - social - ded;
        if (taxable < 0) taxable = 0;
        
        let tax = 0, rate = 0, qd = 0;
        for (let b of BRACKETS) {
            if (taxable <= b.limit) {
                rate = b.rate; qd = b.ded;
                tax = taxable * rate - qd;
                break;
            }
        }
        if (tax < 0) tax = 0;
        
        return { income, social, ded, taxable, rate, qd, tax };
    }

    // ä¸»è®¡ç®—é€»è¾‘
    function calc() {
        // 1. å‡†å¤‡ç¤¾ä¿æ•°æ®
        let socA = 0, socB = 0;
        
        // A
        if ($('autoA').checked) {
            socA = getVal('baseA') * (getVal('rateA')/100) * 12;
            $('resSocA').innerText = socA.toFixed(0);
        } else {
            socA = getVal('manualSocA');
        }
        
        // B
        if ($('autoB').checked) {
            socB = getVal('baseB') * (getVal('rateB')/100) * 12;
            $('resSocB').innerText = socB.toFixed(0);
        } else {
            socB = getVal('manualSocB');
        }

        // 2. å‡†å¤‡åŸºç¡€æ‰£é™¤
        const incA = getVal('incA'), baseDedA = getVal('fixA');
        const incB = getVal('incB'), baseDedB = getVal('fixB');

        // 3. å‡†å¤‡å¯åˆ†é…é¢åº¦
        const amtInfant = getVal('numInfant') * 24000;
        const amtChild = getVal('numChild') * 24000;
        
        // 4. ä½æˆ¿é€»è¾‘å¤„ç†
        const houseType = $('houseType').value;
        let houseAmt = 0;
        let houseOpts = [{a:0, b:0, n:'-' }]; // é»˜è®¤æ— 

        if (houseType === 'loan') {
            houseAmt = 12000; // æˆ¿è´·å®šé¢
            // æˆ¿è´·ï¼šA100, å¹³åˆ†, B100
            houseOpts = [
                {a:1, b:0, n:'Aå…¨æ‰£'},
                {a:0.5, b:0.5, n:'å¹³åˆ†'},
                {a:0, b:1, n:'Bå…¨æ‰£'}
            ];
        } else if (houseType === 'rent') {
            houseAmt = getVal('rentStd') * 12; // ç§Ÿé‡‘æœˆæ ‡å‡†*12
            const rentMode = $('rentMode').value;
            if (rentMode === 'same') {
                // åŒåŸï¼šäº’æ–¥ï¼Œä¸å¯å¹³åˆ†
                houseOpts = [
                    {a:1, b:0, n:'Aå…¨æ‰£'},
                    {a:0, b:1, n:'Bå…¨æ‰£'}
                ];
                $('rentWarn').style.display = 'block';
            } else {
                // å¼‚åœ°ï¼šåŒå€
                houseOpts = [{a:1, b:1, n:'åŒå€(å¼‚åœ°)'}];
                $('rentWarn').style.display = 'none';
            }
        }

        // è‚²å„¿/æ•™è‚² åˆ†é…é€‰é¡¹
        const stdOpts = [
            {a:1, b:0, n:'Aå…¨æ‰£'},
            {a:0.5, b:0.5, n:'å¹³åˆ†'},
            {a:0, b:1, n:'Bå…¨æ‰£'}
        ];

        let scenarios = [];

        // 5. æš´åŠ›ç©·ä¸¾
        stdOpts.forEach(optInf => {
            stdOpts.forEach(optChi => {
                houseOpts.forEach(optHou => {
                    
                    let dedA = baseDedA + (amtInfant*optInf.a) + (amtChild*optChi.a) + (houseAmt*optHou.a);
                    let dedB = baseDedB + (amtInfant*optInf.b) + (amtChild*optChi.b) + (houseAmt*optHou.b);

                    let resA = computeTaxDetail(incA, socA, dedA);
                    let resB = computeTaxDetail(incB, socB, dedB);
                    let total = resA.tax + resB.tax;

                    scenarios.push({
                        id: Math.random().toString(36).substr(2,9),
                        n1: amtInfant ? optInf.n : '-',
                        n2: amtChild ? optChi.n : '-',
                        n3: houseAmt ? optHou.n : '-',
                        resA: resA,
                        resB: resB,
                        total: total
                    });
                });
            });
        });

        // 6. æ’åºä¸æ¸²æŸ“
        scenarios.sort((a,b) => a.total - b.total);
        const best = scenarios[0];
        const worst = scenarios[scenarios.length-1];

        $('txtTotal').innerText = best.total.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2});
        $('txtSave').innerText = (worst.total - best.total).toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2});

        const tbody = $('tblResult').querySelector('tbody');
        tbody.innerHTML = '';

        // ç®€å•å»é‡å±•ç¤ºå‰10ä¸ª
        let count = 0;
        scenarios.forEach((s, i) => {
            if (count > 9 && s.total !== worst.total) return;
            
            let isBest = (i === 0);
            let cls = isBest ? 'best-row' : '';
            let diff = s.total - best.total;
            let diffStr = isBest ? '<span style="color:green">æœ€ä¼˜</span>' : `<span style="color:red">+${diff.toFixed(0)}</span>`;

            let rowHtml = `
                <tr class="clickable ${cls}" onclick="toggleRow('${s.id}')">
                    <td>${i+1}</td>
                    <td>${s.n1}</td>
                    <td>${s.n2}</td>
                    <td>${s.n3}</td>
                    <td align="right">${s.resA.tax.toFixed(0)}</td>
                    <td align="right">${s.resB.tax.toFixed(0)}</td>
                    <td align="right"><strong>${s.resA.tax+s.resB.tax}</strong></td>
                    <td align="center">${diffStr}</td>
                </tr>
                <tr id="det-${s.id}" class="detail-row">
                    <td colspan="8">
                        <div class="detail-pane">
                            ${renderDetailCol('A', s.resA, '#3f51b5')}
                            ${renderDetailCol('B', s.resB, '#e91e63')}
                        </div>
                    </td>
                </tr>
            `;
            tbody.insertAdjacentHTML('beforeend', rowHtml);
            count++;
        });
    }

    function renderDetailCol(role, res, color) {
        return `
        <div class="detail-col">
            <h4 style="color:${color}">ğŸ‘¤ è§’è‰² ${role} è®¡ç®—æ˜ç»†</h4>
            <div class="calc-line"><span>ç¨å‰æ”¶å…¥</span> <span>${res.income.toLocaleString()}</span></div>
            <div class="calc-line"><span>- å‡é™¤è´¹ç”¨</span> <span>60,000</span></div>
            <div class="calc-line"><span>- äº”é™©ä¸€é‡‘</span> <span>${res.social.toLocaleString()}</span></div>
            <div class="calc-line"><span>- ä¸“é¡¹é™„åŠ </span> <span>${res.ded.toLocaleString()}</span></div>
            <div class="calc-line total"><span>= åº”çº³ç¨æ‰€å¾—é¢</span> <span>${res.taxable.toLocaleString()}</span></div>
            <div class="calc-line"><span>Ã— é€‚ç”¨ç¨ç‡</span> <span>${(res.rate*100).toFixed(0)}%</span></div>
            <div class="calc-line"><span>- é€Ÿç®—æ‰£é™¤æ•°</span> <span>${res.qd}</span></div>
            <div class="calc-line total" style="color:${color};font-size:14px;"><span>= æœ€ç»ˆç¨é¢</span> <span>${res.tax.toFixed(2)}</span></div>
        </div>`;
    }

    function toggleRow(id) {
        const row = $('det-'+id);
        row.classList.toggle('open');
    }

    // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
    $('rentMode').addEventListener('change', toggleHouse);
    toggleHouse(); // åˆå§‹è¿è¡Œ
</script>

</body>
</html>
